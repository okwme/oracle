(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{568:function(l,e,t){"use strict";t.r(e);var c=t(0),a=Object(c.a)({},(function(){var l=this,e=l.$createElement,t=l._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":l.$parent.slotKey}},[t("h1",{attrs:{id:"using-the-oracle-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-the-oracle-data"}},[l._v("#")]),l._v(" Using the Oracle Data")]),l._v(" "),t("p",[l._v("In order to use the data provided by the Oracle module, we must make sure all validators come to a consensus about what is commeted to the blockchain state.")]),l._v(" "),t("p",[l._v("While the Oracle module provides some helper methods, the app developer is ultimately responsible for doing this.")]),l._v(" "),t("h2",{attrs:{id:"reaching-consensus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reaching-consensus"}},[l._v("#")]),l._v(" Reaching Consensus")]),l._v(" "),t("p",[l._v("Plan of action:")]),l._v(" "),t("ul",[t("li",[l._v("In our app's EndBlock, query the pending oracle rounds")]),l._v(" "),t("li",[l._v("If we have enough votes to reach consensus, compute the average result of all claims")]),l._v(" "),t("li",[l._v("Write the result on-chain.")])]),l._v(" "),t("p",[l._v("First we need to make sure we add our app to the EndBlock handler. Add your app to "),t("code",[l._v("SetOrderEndBlockers")]),l._v(":")]),l._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"CWFwcC5tbS5TZXRPcmRlckVuZEJsb2NrZXJzKGNyaXNpc3R5cGVzLk1vZHVsZU5hbWUsIGdvdnR5cGVzLk1vZHVsZU5hbWUsIHN0YWtpbmd0eXBlcy5Nb2R1bGVOYW1lLCAmbHQ7eW91cl9hcHBfdHlwZXMmZ3Q7Lk1vZHVsZU5hbWUpCg=="}}),l._v(" "),t("p",[l._v("We will also need to import the Oracle keeper into our app's keeper.")]),l._v(" "),t("p",[l._v("add "),t("code",[l._v("types/expected_keepers.go")])]),l._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"cGFja2FnZSB0eXBlcwoKaW1wb3J0ICgKCXNkayAmcXVvdDtnaXRodWIuY29tL2Nvc21vcy9jb3Ntb3Mtc2RrL3R5cGVzJnF1b3Q7CglvcmFjbGUgJnF1b3Q7Z2l0aHViLmNvbS9yZWxldmFudC1jb21tdW5pdHkvb3JhY2xlL3gvb3JhY2xlL2V4cG9ydGVkJnF1b3Q7CglvcmFjbGV0eXBlcyAmcXVvdDtnaXRodWIuY29tL3JlbGV2YW50LWNvbW11bml0eS9vcmFjbGUveC9vcmFjbGUvdHlwZXMmcXVvdDsKCXRtYnl0ZXMgJnF1b3Q7Z2l0aHViLmNvbS90ZW5kZXJtaW50L3RlbmRlcm1pbnQvbGlicy9ieXRlcyZxdW90OwopCgp0eXBlICgKCS8vIE9yYWNsZUtlZXBlciBpbnRlcmZhY2UKCU9yYWNsZUtlZXBlciBpbnRlcmZhY2UgewoJCUZpbmFsaXplUm91bmQoY3R4IHNkay5Db250ZXh0LCBjbGFpbVR5cGUgc3RyaW5nLCByb3VuZElEIHVpbnQ2NCkKCQlHZXRQZW5kaW5nUm91bmRzKGN0eCBzZGsuQ29udGV4dCwgcm91bmRUeXBlIHN0cmluZykgKHJvdW5kcyBbXXVpbnQ2NCkKCQlUYWxseVZvdGVzKGN0eCBzZGsuQ29udGV4dCwgY2xhaW1UeXBlIHN0cmluZywgcm91bmRJRCB1aW50NjQpICpvcmFjbGV0eXBlcy5Sb3VuZFJlc3VsdAoJCUdldENsYWltKGN0eCBzZGsuQ29udGV4dCwgaGFzaCB0bWJ5dGVzLkhleEJ5dGVzKSBvcmFjbGUuQ2xhaW0KCX0KKQo="}}),l._v(" "),t("p",[l._v("your "),t("code",[l._v("keeper/keeper.go")]),l._v(" file should look like this:")]),l._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"CnR5cGUgKAoJS2VlcGVyIHN0cnVjdCB7CgkJY2RjICAgICAgICAgIGNvZGVjLk1hcnNoYWxlcgoJCXN0b3JlS2V5ICAgICBzZGsuU3RvcmVLZXkKCQltZW1LZXkgICAgICAgc2RrLlN0b3JlS2V5CgkJb3JhY2xlS2VlcGVyIHR5cGVzLk9yYWNsZUtlZXBlcgoJfQopCgpmdW5jIE5ld0tlZXBlcihjZGMgY29kZWMuTWFyc2hhbGVyLCBzdG9yZUtleSwgbWVtS2V5IHNkay5TdG9yZUtleSwgb3JhY2xlS2VlcGVyIHR5cGVzLk9yYWNsZUtlZXBlcikgKktlZXBlciB7CglyZXR1cm4gJmFtcDtLZWVwZXJ7CgkJY2RjOiAgICAgICAgICBjZGMsCgkJc3RvcmVLZXk6ICAgICBzdG9yZUtleSwKCQltZW1LZXk6ICAgICAgIG1lbUtleSwKCQlvcmFjbGVLZWVwZXI6IG9yYWNsZUtlZXBlciwKCX0KfQo="}}),l._v(" "),t("p",[l._v("Finallly, make sure to update your app's keeper constructor inside "),t("code",[l._v("app.go")]),l._v(" file if needed.")]),l._v(" "),t("h2",{attrs:{id:"tally-the-votes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tally-the-votes"}},[l._v("#")]),l._v(" Tally the Votes")]),l._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ZnVuYyAoayBLZWVwZXIpIFVwZGF0ZUF0b21Vc2QoY3R4IHNkay5Db250ZXh0KSB7CgljbGFpbVR5cGUgOj0gdHlwZXMuQXRvbUNsYWltCglwZW5kaW5nIDo9IGsub3JhY2xlS2VlcGVyLkdldFBlbmRpbmdSb3VuZHMoY3R4LCBjbGFpbVR5cGUpCgoJLy8gc29ydCBwZW5kaW5nIHJvdW5kcyBpbiBhc2NlbmRpbmcgb3JkZXIKCXNvcnQuU2xpY2VTdGFibGUocGVuZGluZywgZnVuYyhpLCBqIGludCkgYm9vbCB7IHJldHVybiBwZW5kaW5nW2ldICZsdDsgcGVuZGluZ1tqXSB9KQoKCWZvciBfLCByb3VuZElEIDo9IHJhbmdlIHBlbmRpbmcgewoJCXJlc3VsdCA6PSBrLm9yYWNsZUtlZXBlci5UYWxseVZvdGVzKGN0eCwgY2xhaW1UeXBlLCByb3VuZElEKQoKCQlpZiByZXN1bHQgPT0gbmlsIHx8IHJlc3VsdC5DbGFpbXNbMF0gPT0gbmlsIHsKCQkJY29udGludWUKCQl9CgoJCS8vIHRha2UgYW4gYXZlcmFnZSBvZiBhbGwgY2xhaW1zIGFuZCBjb21taXQgdG8gY2hhaW4KCQlhdmdBdG9tVXNkIDo9IHNkay5OZXdEZWMoMCkKCQl2YXIgYmxvY2tIZWlnaHQgaW50NjQKCQl2YXIgdG90YWxWb3RlUG93ZXIgaW50NjQKCQlmb3IgXywgY2xhaW1SZXN1bHQgOj0gcmFuZ2UgcmVzdWx0LkNsYWltcyB7CgkJCWNsYWltSGFzaCA6PSBjbGFpbVJlc3VsdC5DbGFpbUhhc2gKCQkJYXRvbUNsYWltLCBvayA6PSBrLm9yYWNsZUtlZXBlci5HZXRDbGFpbShjdHgsIGNsYWltSGFzaCkuKCp0eXBlcy5BdG9tVXNkKQoKCQkJaWYgb2sgPT0gZmFsc2UgewoJCQkJZm10LlByaW50ZigmcXVvdDtFcnJvciByZXRyaWV2aW5nIGNsYWltJnF1b3Q7KQoJCQkJY29udGludWUKCQkJfQoJCQl3ZWlnaHRlZEF2ZyA6PSBhdmdBdG9tVXNkLk11bChzZGsuTmV3RGVjKHRvdGFsVm90ZVBvd2VyKSkKCQkJd2VpZ2h0ZWRWb3RlIDo9IGF0b21DbGFpbS5QcmljZS5NdWwoc2RrLk5ld0RlYyhyZXN1bHQuVm90ZVBvd2VyKSkKCQkJdG90YWxWb3RlUG93ZXIgKz0gcmVzdWx0LlZvdGVQb3dlcgoJCQlhdmdBdG9tVXNkID0gd2VpZ2h0ZWRBdmcuQWRkKHdlaWdodGVkVm90ZSkuUXVvKHNkay5OZXdEZWModG90YWxWb3RlUG93ZXIpKQoJCQlibG9ja0hlaWdodCA9IGF0b21DbGFpbS5CbG9ja0hlaWdodAoJCX0KCgkJYXRvbVVzZCA6PSAmYW1wO3R5cGVzLkF0b21Vc2R7CgkJCVByaWNlOiAgICAgICBhdmdBdG9tVXNkLAoJCQlCbG9ja0hlaWdodDogYmxvY2tIZWlnaHQsCgkJfQoJCWsuU2V0QXRvbVVzZChjdHgsICphdG9tVXNkKQoKCQkvLyBUT0RPIGRlbGV0ZSB0aGUgYW55IGVhcmxpZXIgcGVuZGluZyByb3VuZHMKCQlrLm9yYWNsZUtlZXBlci5GaW5hbGl6ZVJvdW5kKGN0eCwgY2xhaW1UeXBlLCByb3VuZElEKQoJfQp9Cg=="}}),l._v(" "),t("p",[l._v("Here is what happens in the code above:")]),l._v(" "),t("ul",[t("li",[l._v("Get all 'PendingRounds' from the oracleKeeper and sort them in ascending order so we can process the early claims first")]),l._v(" "),t("li",[l._v("For each pending round, we tally the votes using the oracleKeeper's "),t("code",[l._v("TallyVotes")]),l._v(" method. If consensus threshold we specified in the params is reached, "),t("code",[l._v("TallyVotes")]),l._v(" returns a "),t("code",[l._v("RoundResult")]),l._v(" struct.")]),l._v(" "),t("li",[l._v("Round")])])],1)}),[],!1,null,null,null);e.default=a.exports}}]);